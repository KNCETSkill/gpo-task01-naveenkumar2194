name: Java Autograding - Brew Size Advisor

on: [push]

permissions:
  checks: write
  actions: read
  contents: read

jobs:
  autograde:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Java
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Compile
        run: javac src/BrewSizeAdvisor.java

      - name: Run All Test Cases
        run: |
          score=0
          max_score=50
          all_passed=true
          tests=()

          # Define test function
          test() {
            input=$1
            expected=$2
            output=$(echo "$input" | java -cp src BrewSizeAdvisor)

            if [ "$output" = "$expected" ]; then
              echo "PASS: Input=$input Output=$output"
              score=$((score+10))
              tests+=("{\"name\":\"Input $input\",\"score\":10,\"max_score\":10,\"output\":\"PASS\"}")
            else
              echo "FAIL: Input=$input Expected=$expected Got=$output"
              all_passed=false
              tests+=("{\"name\":\"Input $input\",\"score\":0,\"max_score\":10,\"output\":\"FAIL: Expected $expected Got $output\"}")
            fi
          }

          # Run all test cases
          test 220 Medium
          test 400 Large
          test 150 Small
          test 200 Medium
          test 350 Medium

          # Human-readable total score
          echo "ðŸŽ¯ TOTAL SCORE: $score / $max_score"

          # Generate results.json for GitHub Classroom
          echo "{\"tests\": [$(IFS=,; echo "${tests[*]}")]}" > results.json

          # Fail workflow if any test failed
          if [ "$all_passed" = false ]; then
            exit 1
          fi